{% extends 'base.html' %}

{% load static %}


{% block content %}
<div class="picture-box">
  <div id="map"></div>
  <div class="card">
    <header class="card-header has-background-light">
      <p class="card-header-title is-clickable">{{ object.name }}</p>
    </header>
    <div class="card-content">
      <div class="content">
        <p class="subtitle is-6"><em>{{ object.description }}</em></p>

        <p class="mb-0"><strong>Coordinates:</strong> {{ object.lat }} - {{ object.lon }}</p>
        {% if object.flight %}
        <p class="mb-0"><em>Attached to flight <strong><a href="{% url 'flights:detail' object.flight.pk %}" title="{{ object.flight.description }}">{{ object.flight.name }}</a></strong></em></p>
        {% endif %}

        <img class="mt-2 lb-source" src="{{ object.data_file.url }}" data-name="{{ object.name }}" data-description="{{ object.description }}">

        <p class="is-flex is-justify-content-space-between mt-5">
          <a class="button is-info" title="Edit this picture" href="{% url 'pictures:update' object.pk %}"><i class="mdi mdi-square-edit-outline"></i></a>
          <button class="button is-danger modal-opener" data-target="delete-pic-modal"><i class="mdi mdi-delete"></i></button>
        </p>

      </div>
    </div>
  </div>
</div>

<div class="modal" id="delete-pic-modal">
  <div class="modal-background"></div>
  <div class="modal-card">
    <header class="modal-card-head">
      <p class="modal-card-title">Are you sure?</p>
    </header>
    <section class="modal-card-body">
      Are you sure you want to delete this picture?
    </section>
    <footer class="modal-card-foot is-flex is-justify-content-flex-end">
      <form method="post" action="{% url 'pictures:delete' object.pk %}">
        {% csrf_token %}
        <input type="submit" value="Yes, delete that!" class="button is-danger" >
      </form>
    </footer>
  </div>
</div>

{% include 'lightbox.part.html' %}
{% include 'tipeee.part.html' %}

{% endblock %}

{% block footer_js %}
<script>
var map = L.map('map').setView([47.4771198,-0.5972396], 6);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);



{% if object.flight %}
let dep = [{{ object.flight.departure.lat }}, {{ object.flight.departure.lon }}]
let arr = [{{ object.flight.arrival.lat }}, {{ object.flight.arrival.lon }}]
let pts = [
{% for wp in object.flight.waypoints.all %}
  [{{ wp.lat }}, {{ wp.lon }}],
{% endfor %}
]

let polyline = drawFlight(dep, arr, pts, map)
{% comment %} map.fitBounds(polyline.polyline.getBounds()) {% endcomment %}
{% endif %}

let coords = [{{ object.lat }}, {{ object.lon }}]
L.marker(coords).addTo(map)

map.panTo(coords)


document.querySelector('header').addEventListener('click', function(event) {
  map.panTo(coords, {animate: true});
});

</script>
{% endblock %}
